from keys_api1 import *
import sys
import tweepy
import time
from random import randint
from functools import reduce
import pandas as pd  

while True:
    try:
        auth = tweepy.OAuthHandler(api_key, api_key_secret)
        auth.set_access_token(access_token, access_token_secret)
        api = tweepy.API(auth, wait_on_rate_limit=True)

        var_screen_name = "RTenfrancais"

        c = tweepy.Cursor(api.get_follower_ids, screen_name = var_screen_name, count = 4990)
        ids = []
        for page in c.pages():
            ids.append(page)
        
        #2D list to 1D and saving to a csv output

        ids = reduce(lambda x,y :x+y ,ids)
        dict = { "twitter_ids" : ids}
        df = pd.DataFrame(dict)
        df.to_csv('output.csv')

        #terminate the processus
        t = time.localtime()
        current_time = time.strftime("%H:%M:%S", t)
        print("Prcessus finished -- ", current_time, " --")
        break

    except tweepy.TweepyException:
        t = time.localtime()
        current_time = time.strftime("%H:%M:%S", t)
        print("Tweepy Exception detected -- ", current_time, " --")
        print ("tweepy.TweepyException = ", tweepy.TweepyException)
        continue
    except:
        e = sys.exc_info()[0]
        t = time.localtime()
        current_time = time.strftime("%H:%M:%S", t)
        print("Unknown Exception detected -- ", current_time, " --")
        print("Error: %s" % e)
        continue